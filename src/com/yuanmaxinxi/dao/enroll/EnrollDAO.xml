<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yuanmaxinxi.dao.enroll.EnrollDAO">
    <insert id="insert" parameterType="Enroll">
        insert into t_enroll(uId,pId,mId,bId,number,maxNumber,avgNumber,minNumber,minRanking,time)value(#{uId},#{pId},#{mId},#{bId},#{number},#{maxNumber},#{avgNumber},#{minNumber},#{minRanking},#{time})
    </insert>
    <update id="update" parameterType="Enroll">
		update t_enroll set avgRanking=#{avgRanking} where id = #{id}        
    </update>
<!--     <update id="edit" parameterType="Admin"> -->
<!-- 		update t_admin set name = #{name},phone=phone=#{phone} where id = #{ip}  -->
<!--     </update> -->
<!--     <delete id="delete" parameterType="Long"> -->
<!--         delete from t_admin where id=#{id} -->
<!--     </delete> -->
<!--     <select id="selectOneById" parameterType="Long" resultType="Admin"> -->
<!--         select * from t_admin where id=#{id} -->
<!--     </select> -->
    <select id="selectAll" resultType="Enroll">
        select * from t_enroll
    </select>
<!--     <select id="selectOneByUsername" resultType="Admin"> -->
<!--         select * from t_admin where username = #{username} -->
<!--     </select> -->
	<select id="selectCount" parameterType="com.yuanmaxinxi.dto.MyBatisQueryPageDTO" resultType="int">
        select count(id) from t_enroll
        <include refid="whereSql"></include>
    </select>
    <select id="queryPage" parameterType="com.yuanmaxinxi.dto.MyBatisQueryPageDTO" resultType="Enroll">
        select * from t_enroll <include refid="whereSql"></include> 
        limit #{beginIndex},#{pageSize}
    </select>
    <sql id="whereSql">
        <where>
            <if test="name!=null and name != ''">
                and instr(name,#{name})
            </if>
        </where>
    </sql>
    <select id="selectEnrollProvince" resultType="Province">
        select id,name from t_province where id in (
        	select distinct pId from t_enroll
        )
    </select>
    <select id="serch" parameterType="map" resultType="Enroll">
        select en.* from ( 
	  		select * from t_enroll 
	  		where #{pId} = 20 and minRanking>=(${ranking}-#{range}) and (${ranking}+#{range}) >= maxRanking
	  		and bId = #{bId}
	   )en where en.minNumber >=#{number} and en.maxNumber >= #{number} and en.time>2000 order by time desc
    </select>
</mapper>